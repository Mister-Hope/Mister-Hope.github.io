import{_ as l}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as e,d as n,f as a,e as p,b as o,o as t}from"./app-BGIrljxn.js";const c={};function r(i,s){return t(),e("div",null,[s[0]||(s[0]=n("p",null,[a("在 HTML 表单中，可以上传文件的唯一控件就是 "),n("code",null,'<input type="file">'),a("。")],-1)),p(" more "),s[1]||(s[1]=o(`<div class="hint-container warning"><p class="hint-container-title">注意</p><p>当一个表单包含 <code>&lt;input type=&quot;file&quot;&gt;</code> 时，表单的 <code>enctype</code> 必须指定为 <code>multipart/form-data</code>，<code>method</code> 必须指定为 <code>post</code>，浏览器才能正确编码并以 <code>multipart/form-data</code> 格式发送表单的数据。</p></div><p>出于安全考虑，浏览器只允许用户点击 <code>&lt;input type=&quot;file&quot;&gt;</code> 来选择本地文件，用 JavaScript 对 <code>&lt;input type=&quot;file&quot;&gt;</code> 的 <code>value</code> 赋值是没有任何效果的。当用户选择了上传某个文件后，JavaScript 也无法获得该文件的真实路径:</p><p>通常，上传的文件都由后台服务器处理，JavaScript 可以在提交表单时对文件扩展名做检查，以便防止用户上传无效格式的文件:</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> f</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> document</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">querySelector</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">#test-file-upload</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> filename</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> f</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">value</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // &#39;C:\\fake-path\\test.png&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> (</span></span>
<span class="line"><span style="color:#81A1C1;">  !</span><span style="color:#D8DEE9;">filename</span><span style="color:#81A1C1;"> ||</span></span>
<span class="line"><span style="color:#81A1C1;">  !</span><span style="color:#D8DEE9FF;">(</span></span>
<span class="line"><span style="color:#D8DEE9;">    filename</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">endsWith</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">.jpg</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">||</span></span>
<span class="line"><span style="color:#D8DEE9;">    filename</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">endsWith</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">.png</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">||</span></span>
<span class="line"><span style="color:#D8DEE9;">    filename</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">endsWith</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">.gif</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  )</span></span>
<span class="line"><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">  alert</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Can only upload image file.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">  return</span><span style="color:#81A1C1;"> false;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="file-api" tabindex="-1"><a class="header-anchor" href="#file-api"><span>File API</span></a></h2><p>由于 JavaScript 对用户上传的文件操作非常有限，尤其是无法读取文件内容，使得很多需要操作文件的网页不得不用 Flash 这样的第三方插件来实现。</p><p>随着 HTML5 的普及，新增的 File API 允许 JavaScript 读取文件内容，获得更多的文件信息。</p><p>HTML5 的 File API 提供了 <code>File</code> 和 <code>FileReader</code> 两个主要对象，可以获得文件信息并读取文件。</p><p>下面的例子演示了如何读取用户选取的图片文件，并在一个 <code>&lt;div&gt;</code> 中预览图像:</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> fileInput</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> document</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">querySelector</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">#test-image-file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> info</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> document</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">querySelector</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">#test-file-info</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9;"> preview</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> document</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">querySelector</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">#test-image-preview</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 监听change事件:</span></span>
<span class="line"><span style="color:#D8DEE9;">fileInput</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">addEventListener</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">change</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> ()</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 清除背景图片:</span></span>
<span class="line"><span style="color:#D8DEE9;">  preview</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">style</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">backgroundImage</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 检查文件是否选择:</span></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9;">fileInput</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">value</span><span style="color:#D8DEE9FF;">) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">    info</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">innerHTML</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">没有选择文件</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#616E88;">  // 获取File引用:</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> file</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> fileInput</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">files</span><span style="color:#D8DEE9FF;">[</span><span style="color:#B48EAD;">0</span><span style="color:#D8DEE9FF;">]</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">  // 获取File信息:</span></span>
<span class="line"><span style="color:#D8DEE9;">  info</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">innerHTML</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> \`</span><span style="color:#A3BE8C;">文件: </span><span style="color:#81A1C1;">\${</span><span style="color:#D8DEE9;">file</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">name</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">&lt;br&gt;大小: </span><span style="color:#81A1C1;">\${</span><span style="color:#D8DEE9;">file</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">size</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">&lt;br&gt;修改: </span><span style="color:#81A1C1;">\${</span><span style="color:#D8DEE9;">file</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">lastModifiedDate</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">\`</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">  if</span><span style="color:#D8DEE9FF;"> (</span></span>
<span class="line"><span style="color:#D8DEE9;">    file</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">type</span><span style="color:#81A1C1;"> !==</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">image/jpeg</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> &amp;&amp;</span></span>
<span class="line"><span style="color:#D8DEE9;">    file</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">type</span><span style="color:#81A1C1;"> !==</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">image/png</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> &amp;&amp;</span></span>
<span class="line"><span style="color:#D8DEE9;">    file</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">type</span><span style="color:#81A1C1;"> !==</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">image/gif</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  ) </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#88C0D0;">    alert</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">不是有效的图片文件!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#81A1C1;">    return;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span></span>
<span class="line"><span style="color:#616E88;">  // 读取文件:</span></span>
<span class="line"><span style="color:#81A1C1;">  const</span><span style="color:#D8DEE9;"> reader</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> FileReader</span><span style="color:#D8DEE9FF;">()</span><span style="color:#81A1C1;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">  reader</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">onload</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#81A1C1;">    const</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> e</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">target</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">result</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // &#39;data:image/jpeg;base64,/9j/4AAQSk...(base64编码)...&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">    preview</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">style</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">backgroundImage</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> \`</span><span style="color:#A3BE8C;">url(</span><span style="color:#81A1C1;">\${</span><span style="color:#D8DEE9;">data</span><span style="color:#81A1C1;">}</span><span style="color:#A3BE8C;">)</span><span style="color:#ECEFF4;">\`</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">  }</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#616E88;">  // 以DataURL的形式读取文件:</span></span>
<span class="line"><span style="color:#D8DEE9;">  reader</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readAsDataURL</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">file</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的代码演示了如何通过 HTML5 的 File API 读取文件内容。以 DataURL 的形式读取到的文件是一个字符串，类似于 <code>data:image/jpeg;base64,/9j/4AAQSk...(base64编码)...</code>，常用于设置图像。如果需要服务器端处理，把字符串 <code>base64</code>,后面的字符发送给服务器并用 base64 解码就可以得到原始文件的二进制内容。</p><h2 id="回调" tabindex="-1"><a class="header-anchor" href="#回调"><span>回调</span></a></h2><p>上面的代码还演示了 JavaScript 的一个重要的特性就是单线程执行模式。在 JavaScript 中，浏览器的 JavaScript 执行引擎在执行 JavaScript 代码时，总是以单线程模式执行，也就是说，任何时候，JavaScript 代码都不可能同时有多于 <code>1</code> 个线程在执行。</p><p>您可能会问，单线程模式执行的 JavaScript，如何处理多任务?</p><p>在 JavaScript 中，执行多任务实际上都是异步调用，比如上面的代码:</p><div class="language-js" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">reader</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">readAsDataURL</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">file</span><span style="color:#D8DEE9FF;">)</span><span style="color:#81A1C1;">;</span></span></code></pre></div><p>就会发起一个异步操作来读取文件内容。因为是异步操作，所以我们在 JavaScript 代码中就不知道什么时候操作结束，因此需要先设置一个回调函数:</p><div class="language-js" data-highlighter="shiki" data-ext="js" data-title="js" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#D8DEE9;">reader</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">onload</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">e</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> =&gt;</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">  // 当文件读取完成后，自动调用此函数:</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#81A1C1;">;</span></span></code></pre></div><p>当文件读取完成后，JavaScript 引擎将自动调用我们设置的回调函数。执行回调函数时，文件已经读取完毕，所以我们可以在回调函数内部安全地获得文件内容。</p>`,19))])}const d=l(c,[["render",r],["__file","file.html.vue"]]),F=JSON.parse('{"path":"/code/language/js/browser/file.html","title":"操作文件","lang":"zh-CN","frontmatter":{"title":"操作文件","icon":"file","date":"2019-10-17T00:00:00.000Z","category":"JavaScript","description":"在 HTML 表单中，可以上传文件的唯一控件就是 <input type=\\"file\\">。","head":[["meta",{"property":"og:url","content":"https://mister-hope.com/code/language/js/browser/file.html"}],["meta",{"property":"og:site_name","content":"Mr.Hope"}],["meta",{"property":"og:title","content":"操作文件"}],["meta",{"property":"og:description","content":"在 HTML 表单中，可以上传文件的唯一控件就是 <input type=\\"file\\">。"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2022-12-09T17:12:58.000Z"}],["meta",{"property":"article:author","content":"Mr.Hope"}],["meta",{"property":"article:published_time","content":"2019-10-17T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2022-12-09T17:12:58.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"操作文件\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2019-10-17T00:00:00.000Z\\",\\"dateModified\\":\\"2022-12-09T17:12:58.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mr.Hope\\",\\"url\\":\\"https://mister-hope.com\\"}]}"],["link",{"rel":"alternate","type":"application/atom+xml","href":"https://mister-hope.com/atom.xml","title":"Mr.Hope Atom Feed"}],["link",{"rel":"alternate","type":"application/json","href":"https://mister-hope.com/feed.json","title":"Mr.Hope JSON Feed"}],["link",{"rel":"alternate","type":"application/rss+xml","href":"https://mister-hope.com/rss.xml","title":"Mr.Hope RSS Feed"}]]},"headers":[{"level":2,"title":"File API","slug":"file-api","link":"#file-api","children":[]},{"level":2,"title":"回调","slug":"回调","link":"#回调","children":[]}],"git":{"createdTime":1591204114000,"updatedTime":1670605978000,"contributors":[{"name":"Mr.Hope","email":"zhangbowang1998@gmail.com","commits":7},{"name":"Mr.Hope","email":"mister-hope@outlook.com","commits":1}]},"readingTime":{"minutes":3,"words":899},"filePathRelative":"code/language/js/browser/file.md","localizedDate":"2019年10月17日","excerpt":"<p>在 HTML 表单中，可以上传文件的唯一控件就是 <code>&lt;input type=\\"file\\"&gt;</code>。</p>\\n","autoDesc":true}');export{d as comp,F as data};
